# API دانلودر یوتیوب

یک بک‌اند FastAPI آماده برای تولید جهت دانلود ویدیوها، صداها، زیرنویس‌ها و تصاویر بندانگشتی یوتیوب با قدرت yt-dlp.

## اخطار حقوقی

**⚠️ مهم:** این ابزار فقط برای استفاده شخصی و آموزشی است. دانلود محتوای دارای حق نشر ممکن است قوانین سرویس یوتیوب و قوانین حق نشر در کشور شما را نقض کند. مسئولانه استفاده کنید و فقط محتوایی را دانلود کنید که حق دانلود آن را دارید.

## امکانات

- **اطلاعات ویدیو**: دریافت متادیتای کامل برای هر ویدیو یا لیست پخش یوتیوب
- **لیست فرمت‌ها**: مشاهده تمام فرمت‌های موجود (ویدیو، صدا، ترکیبی)
- **دانلود ویدیو**: دانلود ویدیوها با کیفیت‌های مختلف (بهترین، 720p، 1080p، 1440p، 4k)
- **دانلود صدا**: استخراج صدا به فرمت MP3، M4A یا بهترین کیفیت
- **پشتیبانی از لیست پخش**: دانلود کل لیست پخش یا انتخاب ویدیوهای خاص
- **زیرنویس**: دریافت زیرنویس‌های موجود به هر زبانی (دستی و خودکار)
- **تصاویر بندانگشتی**: دریافت تصاویر بندانگشتی ویدیو با کیفیت‌های مختلف
- **پردازش پس‌زمینه**: دانلودهای طولانی در پس‌زمینه با ردیابی پیشرفت اجرا می‌شوند
- **محدودیت نرخ**: محافظت داخلی در برابر سوء استفاده از API
- **رابط کاربری دوزبانه**: رابط تست تعاملی به انگلیسی و فارسی

## پیش‌نیازها

- Python 3.11 یا بالاتر
- ffmpeg (برای تبدیل صدا و ادغام ویدیو)

## نصب

1. کلون کردن مخزن:
```bash
git clone <repository-url>
cd youtube-downloader-api
```

2. نصب وابستگی‌ها:
```bash
pip install -r requirements.txt
```

3. اطمینان از نصب ffmpeg:
```bash
# اوبونتو/دبیان
sudo apt install ffmpeg

# مک
brew install ffmpeg

# ویندوز
# دانلود از https://ffmpeg.org/download.html
```

4. اجرای سرور:
```bash
uvicorn main:app --host 0.0.0.0 --port 5000 --reload
```

## شروع سریع

1. رابط کاربری تست را در آدرس زیر باز کنید: `http://localhost:5000`
2. یا به مستندات API در آدرس زیر دسترسی پیدا کنید: `http://localhost:5000/docs`

## نقاط پایانی API

### GET /info
دریافت اطلاعات ویدیو یا لیست پخش.

**پارامترها:**
- `url` (الزامی): آدرس ویدیو یا لیست پخش یوتیوب

**مثال:**
```bash
curl "http://localhost:5000/info?url=https://www.youtube.com/watch?v=VIDEO_ID"
```

### GET /formats
دریافت فرمت‌های موجود برای یک ویدیو.

**پارامترها:**
- `url` (الزامی): آدرس ویدیو یوتیوب

**مثال:**
```bash
curl "http://localhost:5000/formats?url=https://www.youtube.com/watch?v=VIDEO_ID"
```

### POST /download/single
دانلود یک ویدیو یا فایل صوتی.

**پارامترهای بدنه:**
- `url` (الزامی): آدرس ویدیو یوتیوب
- `quality`: "best"، "worst"، "720p"، "1080p"، "1440p"، "4k"، "audio_only"
- `type`: "video"، "audio"
- `audio_format`: "best"، "mp3"، "m4a"
- `format_id`: شناسه فرمت خاص (اولویت بر quality دارد)

**مثال:**
```bash
curl -X POST "http://localhost:5000/download/single" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://www.youtube.com/watch?v=VIDEO_ID", "quality": "720p"}'
```

### GET /status/{job_id}
بررسی پیشرفت دانلود.

**مثال:**
```bash
curl "http://localhost:5000/status/YOUR_JOB_ID"
```

### GET /download/file/{filename}
دانلود فایل پردازش شده.

### GET /download/playlist/info
دریافت اطلاعات لیست پخش.

**پارامترها:**
- `url` (الزامی): آدرس لیست پخش یوتیوب

### POST /download/playlist/all
دانلود تمام ویدیوهای یک لیست پخش.

### POST /download/playlist/select
دانلود ویدیوهای انتخابی از یک لیست پخش.

**پارامترهای بدنه:**
- `url` (الزامی): آدرس لیست پخش یوتیوب
- `video_indices`: لیست اندیس ویدیوهای مورد نظر برای دانلود
- `quality`، `type`، `audio_format`: مشابه دانلود تکی

### GET /subtitles
دریافت زیرنویس‌های موجود.

**پارامترها:**
- `url` (الزامی): آدرس ویدیو یوتیوب
- `lang`: کد زبان ("en"، "fa"، "all" و غیره)

### POST /subtitles
دانلود فایل زیرنویس.

**پارامترهای بدنه:**
- `url` (الزامی): آدرس ویدیو یوتیوب
- `lang`: کد زبان
- `auto`: شامل زیرنویس‌های خودکار (بولین)

### GET /thumbnail
دریافت تصویر بندانگشتی ویدیو.

**پارامترها:**
- `url` (الزامی): آدرس ویدیو یوتیوب
- `quality`: "maxres"، "hq"، "mq"، "sd"، "default"

## پیکربندی

متغیرهای محیطی:
- `CLEANUP_TIMEOUT_MINUTES`: زمان پاکسازی فایل‌های دانلود شده (پیش‌فرض: 30 دقیقه)
- `MAX_REQUESTS_PER_MINUTE`: محدودیت درخواست به ازای هر IP (پیش‌فرض: 30)

## مدیریت خطا

API کدهای وضعیت HTTP مناسب را برمی‌گرداند:
- `200`: موفقیت
- `400`: درخواست نامعتبر (آدرس نادرست و غیره)
- `403`: دسترسی ممنوع (ویدیو خصوصی، محدودیت سنی)
- `404`: یافت نشد (ویدیو در دسترس نیست)
- `429`: تجاوز از محدودیت نرخ
- `500`: خطای داخلی سرور

## رابط کاربری تست

به رابط تست تعاملی در آدرس اصلی (`/`) دسترسی پیدا کنید. امکانات:
- تست تمام نقاط پایانی API
- تغییر بین انگلیسی و فارسی
- مشاهده پاسخ‌های JSON
- دانلود مستقیم فایل‌ها

## پاکسازی فایل

فایل‌های دانلود شده به طور خودکار پس از 30 دقیقه برای صرفه‌جویی در فضای ذخیره‌سازی حذف می‌شوند.

## محدودیت نرخ

API درخواست‌ها را به 30 درخواست در دقیقه برای هر آدرس IP محدود می‌کند تا از سوء استفاده جلوگیری شود.

## مجوز

مجوز MIT - برای جزئیات فایل LICENSE را ببینید.
